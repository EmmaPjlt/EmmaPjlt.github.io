"use strict";(self.webpackChunkAlicia_website=self.webpackChunkAlicia_website||[]).push([[9697],{3905:(e,n,t)=>{t.d(n,{Zo:()=>p,kt:()=>g});var r=t(7294);function a(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function s(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);n&&(r=r.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,r)}return t}function i(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?s(Object(t),!0).forEach((function(n){a(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):s(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function o(e,n){if(null==e)return{};var t,r,a=function(e,n){if(null==e)return{};var t,r,a={},s=Object.keys(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||(a[t]=e[t]);return a}(e,n);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(r=0;r<s.length;r++)t=s[r],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(a[t]=e[t])}return a}var l=r.createContext({}),u=function(e){var n=r.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):i(i({},n),e)),t},p=function(e){var n=u(e.components);return r.createElement(l.Provider,{value:n},e.children)},c="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return r.createElement(r.Fragment,{},n)}},d=r.forwardRef((function(e,n){var t=e.components,a=e.mdxType,s=e.originalType,l=e.parentName,p=o(e,["components","mdxType","originalType","parentName"]),c=u(t),d=a,g=c["".concat(l,".").concat(d)]||c[d]||m[d]||s;return t?r.createElement(g,i(i({ref:n},p),{},{components:t})):r.createElement(g,i({ref:n},p))}));function g(e,n){var t=arguments,a=n&&n.mdxType;if("string"==typeof e||a){var s=t.length,i=new Array(s);i[0]=d;var o={};for(var l in n)hasOwnProperty.call(n,l)&&(o[l]=n[l]);o.originalType=e,o[c]="string"==typeof e?e:a,i[1]=o;for(var u=2;u<s;u++)i[u]=t[u];return r.createElement.apply(null,i)}return r.createElement.apply(null,t)}d.displayName="MDXCreateElement"},6909:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>m,frontMatter:()=>s,metadata:()=>o,toc:()=>u});var r=t(7462),a=(t(7294),t(3905));const s={title:"Vite \u591a\u9875\u9762\u914d\u7f6e",tags:["Vite","Vue","\u591a\u5165\u53e3"],sidebar_position:2},i="Vite \u591a\u9875\u9762\u914d\u7f6e",o={unversionedId:"Vue&Vite&uniapp/Vite\u591a\u9875\u9762\u914d\u7f6e",id:"Vue&Vite&uniapp/Vite\u591a\u9875\u9762\u914d\u7f6e",title:"Vite \u591a\u9875\u9762\u914d\u7f6e",description:"\u95ee\u9898\u80cc\u666f\uff1a  \u9488\u5bf9\u4f7f\u7528 vue3 \u5f00\u53d1\u7684 h5 \u5e94\u7528\uff0c\u6839\u636e\u4f20\u7edf\u7684 vite \u542f\u52a8\u7684\u5355\u9875\u9762\u5e94\u7528\uff0c\u4e00\u822c\u662f\u4e00\u4e2a\u5165\u53e3\u5bf9\u5e94\u4e00\u4e2a\u51fa\u53e3\uff0c\u4f46 h5 \u5e94\u7528\u6162\u6162\u589e\u591a\uff0c\u5982\u679c\u8fd8\u662f\u6309\u7167\u5355\u5165\u53e3\u5355\u51fa\u53e3\u7684\u6a21\u5f0f\u8fdb\u884c\u5f00\u53d1\uff0c\u610f\u5473\u7740\u6bcf\u6b21\u65b0\u589e\u4e00\u4e2a h5 \u5e94\u7528\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u65b0\u642d\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u5c01\u88c5\u7684\u516c\u5171\u65b9\u6cd5\u3001\u9879\u76ee\u7684\u914d\u7f6e\u4e5f\u90fd\u9700\u8981\u518d\u6b21\u8fdb\u884c\u4e00\u6b21\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u91cd\u590d\u5de5\u4f5c\u3002",source:"@site/docs/4-Vue&Vite&uniapp/Vite\u591a\u9875\u9762\u914d\u7f6e.md",sourceDirName:"4-Vue&Vite&uniapp",slug:"/Vue&Vite&uniapp/Vite\u591a\u9875\u9762\u914d\u7f6e",permalink:"/Vue&Vite&uniapp/Vite\u591a\u9875\u9762\u914d\u7f6e",draft:!1,tags:[{label:"Vite",permalink:"/tags/vite"},{label:"Vue",permalink:"/tags/vue"},{label:"\u591a\u5165\u53e3",permalink:"/tags/\u591a\u5165\u53e3"}],version:"current",sidebarPosition:2,frontMatter:{title:"Vite \u591a\u9875\u9762\u914d\u7f6e",tags:["Vite","Vue","\u591a\u5165\u53e3"],sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"\u5f00\u53d1\u5e38\u89c1\u95ee\u9898\u603b\u7ed3",permalink:"/Vue&Vite&uniapp/Vue"},next:{title:"\u5728 VScode \u4e2d\u5f00\u53d1 uni-app",permalink:"/Vue&Vite&uniapp/uni-app"}},l={},u=[{value:"1\u3001\u76ee\u5f55",id:"1\u76ee\u5f55",level:2},{value:"2\u3001vite.config.ts",id:"2viteconfigts",level:2},{value:"3\u3001\u6253\u5305\u5de5\u5177\u51fd\u6570 build.js\uff0c\u6309\u9700\u6253\u5305",id:"3\u6253\u5305\u5de5\u5177\u51fd\u6570-buildjs\u6309\u9700\u6253\u5305",level:2},{value:"4\u3001.modulerc.ts",id:"4modulercts",level:2},{value:"5\u3001router/index.ts \u6587\u4ef6",id:"5routerindexts-\u6587\u4ef6",level:2},{value:"6\u3001applications.vue",id:"6applicationsvue",level:2},{value:"7\u3001\u547d\u4ee4",id:"7\u547d\u4ee4",level:2},{value:"8\u3001\u5355\u5165\u53e3\u603b\u7ed3",id:"8\u5355\u5165\u53e3\u603b\u7ed3",level:2},{value:"9\u3001\u66f4\u6539\u4e3a\u591a\u5165\u53e3",id:"9\u66f4\u6539\u4e3a\u591a\u5165\u53e3",level:2},{value:"10\u3001\u589e\u52a0\u65b0\u5efa\u811a\u672c",id:"10\u589e\u52a0\u65b0\u5efa\u811a\u672c",level:2}],p={toc:u},c="wrapper";function m(e){let{components:n,...t}=e;return(0,a.kt)(c,(0,r.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"vite-\u591a\u9875\u9762\u914d\u7f6e"},"Vite \u591a\u9875\u9762\u914d\u7f6e"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u95ee\u9898\u80cc\u666f\uff1a"),"  \u9488\u5bf9\u4f7f\u7528 vue3 \u5f00\u53d1\u7684 h5 \u5e94\u7528\uff0c\u6839\u636e\u4f20\u7edf\u7684 vite \u542f\u52a8\u7684\u5355\u9875\u9762\u5e94\u7528\uff0c\u4e00\u822c\u662f\u4e00\u4e2a\u5165\u53e3\u5bf9\u5e94\u4e00\u4e2a\u51fa\u53e3\uff0c\u4f46 h5 \u5e94\u7528\u6162\u6162\u589e\u591a\uff0c\u5982\u679c\u8fd8\u662f\u6309\u7167\u5355\u5165\u53e3\u5355\u51fa\u53e3\u7684\u6a21\u5f0f\u8fdb\u884c\u5f00\u53d1\uff0c\u610f\u5473\u7740\u6bcf\u6b21\u65b0\u589e\u4e00\u4e2a h5 \u5e94\u7528\u7684\u65f6\u5019\uff0c\u6211\u4eec\u9700\u8981\u65b0\u642d\u5efa\u4e00\u4e2a\u9879\u76ee\uff0c\u5c01\u88c5\u7684\u516c\u5171\u65b9\u6cd5\u3001\u9879\u76ee\u7684\u914d\u7f6e\u4e5f\u90fd\u9700\u8981\u518d\u6b21\u8fdb\u884c\u4e00\u6b21\uff0c\u4f1a\u4ea7\u751f\u5927\u91cf\u91cd\u590d\u5de5\u4f5c\u3002"),(0,a.kt)("p",null,(0,a.kt)("strong",{parentName:"p"},"\u89e3\u51b3\u601d\u8def\uff1a"),"  \u628a vite \u7684\u5355\u5165\u53e3\u5355\u51fa\u53e3\u914d\u7f6e\u6539\u4e3a\u5355\u5165\u53e3\u591a\u51fa\u53e3\uff0c\u6309\u9700\u6253\u5305\u591a\u9875\u9762.(\u4e3a\u4ec0\u4e48\u4e0d\u6539\u6210\u591a\u5165\u53e3\u591a\u51fa\u53e3\u5462\uff0c\u56e0\u4e3a\u6211\u4eec\u76ee\u524d\u6d89\u53ca\u5230\u7684\u9879\u76ee\u5927\u591a\u4e3a\u6bd4\u8f83\u7b80\u5355\u7684 h5 \u5e94\u7528\uff0c\u6ca1\u6709\u5fc5\u8981\u7ed9\u6bcf\u4e2a\u5305\u914d\u7f6e\u5355\u72ec\u7684\u5165\u53e3\uff0c\u7b49\u540e\u7eed\u5982\u679c\u6709\u9700\u6c42\uff0c\u53ef\u4ee5\u5728\u8fd9\u4e2a\u57fa\u7840\u4e0a\u8fdb\u884c\u6539\u52a8)\u3002"),(0,a.kt)("h2",{id:"1\u76ee\u5f55"},"1\u3001\u76ee\u5f55"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-shell"},"\u6839\u76ee\u5f55\n\u251c\u2500 dist  # \u6253\u5305\u540e\u9879\u76ee\u76ee\u5f55\n\u2502  \u251c\u2500 page1\n\u2502     \u251c\u2500 index.html\n\u2502     \u2514\u2500 static\n\u2502  \u251c\u2500 page2\n\u2502     \u251c\u2500 index.html\n\u2502     \u2514\u2500 static\n\u251c\u2500 public  # \u56fe\u7247\n\u251c\u2500 scripts # \u811a\u672c\u6587\u4ef6\n\u2502  \u2514\u2500 build.js # \u6253\u5305\u811a\u672c\n\u251c\u2500 src\n\u2502  \u251c\u2500 assets # \u9759\u6001\u8d44\u6e90\n\u2502  \u251c\u2500 components # \u516c\u5171\u7ec4\u4ef6\n\u2502  \u251c\u2500 modules # \u591a\u9875\u9762\u9879\u76ee\u76ee\u5f55\n\u2502     \u251c\u2500 page1 # \u9879\u76ee1\n\u2502        \u251c\u2500 router # \u9879\u76ee1\u7684\u8def\u7531\u6587\u4ef6\n\u2502        \u251c\u2500 services/store # \u9879\u76ee1\u7684\u5176\u4ed6\u6587\u4ef6\n\u2502        \u2514\u2500 view # \u9879\u76ee1\u7684\u9875\u9762\u6587\u4ef6\n\u2502     \u251c\u2500 page1 # \u9879\u76ee2\n\u2502        \u251c\u2500 router # \u9879\u76ee2\u7684\u8def\u7531\u6587\u4ef6\n\u2502        \u251c\u2500 services/store # \u9879\u76ee2\u7684\u5176\u4ed6\u6587\u4ef6\n\u2502        \u2514\u2500 view # \u9879\u76ee2\u7684\u9875\u9762\u6587\u4ef6\n\u2502  \u251c\u2500 router # \u8def\u7531\u6587\u4ef6\n\u2502     \u251c\u2500 index.ts # \u5904\u7406\u8def\u7531\n\u2502  \u251c\u2500 APP.vue\n\u2502  \u251c\u2500 applications.vue # applications\uff0c\u672c\u5730\u542f\u52a8\u7684\u7edf\u4e00\u5165\u53e3vue\n\u2502  \u2514\u2500 main.ts\n\u251c\u2500 index.html # \u7edf\u4e00\u5165\u53e3\u6587\u4ef6\n\u251c\u2500 .modulerc.ts # \u6c47\u603brc\u6587\u4ef6\n\u251c\u2500 env.d.ts # \u7c7b\u578b\u6587\u4ef6\n\u251c\u2500 package.json\n\u251c\u2500 tsconfig.json\n\u251c\u2500 .gitignore\n\u251c\u2500 .npmrc\n\u251c\u2500 vite.config.json\n\u2514 README.md\n")),(0,a.kt)("h2",{id:"2viteconfigts"},"2\u3001vite.config.ts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'import { fileURLToPath, URL } from "node:url";\n\nimport { defineConfig } from "vite";\nimport { viteMockServe } from "vite-plugin-mock";\nimport vue from "@vitejs/plugin-vue";\nimport vueJsx from "@vitejs/plugin-vue-jsx";\nimport path from "path";\nimport legacy from \'@vitejs/plugin-legacy\';\n\nexport default defineConfig(({command, mode})=>{\n  return {\n    plugins: [\n      vue(),\n      vueJsx(),\n      viteMockServe({\n        mockPath: "./mock",  // mock\u6587\u4ef6\u5b58\u653e\u7684\u4f4d\u7f6e\n        localEnabled: command === "serve" && mode === "mock", //\u5728\u5f00\u53d1\u73af\u5883\u4e2d\u542f\u7528 mock\n      }),\n      legacy({\n        targets: [\'Chrome 52\'],\n        additionalLegacyPolyfills: [\'regenerator-runtime/runtime\'],\n        modernPolyfills: true,\n      }),\n    ],\n    base: \'/app/mes/\',\n    resolve: {\n      alias: {\n        "@": fileURLToPath(new URL("./src", import.meta.url)),\n      },\n    },\n    server: {\n      host: \'0.0.0.0\',\n      proxy: {\n        \'^/MESWebApi\': {\n          target: \'http://172.16.7.181\',\n          changeOrigin: true, //\u5f00\u542f\u4ee3\u7406\n        }\n      }\n    },\n    build: {\n      // \u6d4f\u89c8\u5668\u517c\u5bb9\u6027 \u2018esnext\u2019 | \'modules\'\n      target: "modules",\n      //\u8f93\u51fa\u8def\u5f84\n      outDir: `${process.cwd()}/dist/${process.argv[process.argv.length-1]}`,\n      // \u5c0f\u4e8e\u6b64\u9608\u503c\u7684\u5bfc\u5165\u6216\u5f15\u7528\u8d44\u6e90\u5c06\u5185\u8054\u4e3a base64 \u7f16\u7801\uff0c \u4ee5\u907f\u514d\u989d\u5916\u7684http\u8bf7\u6c42\uff0c \u8bbe\u7f6e\u4e3a 0, \u53ef\u4ee5\u5b8c\u5168\u7981\u7528\u6b64\u9879\uff0c\n      assetsInlineLimit: 4096,\n      // \u542f\u52a8 / \u7981\u7528 CSS \u4ee3\u7801\u62c6\u5206\n      cssCodeSplit: true,\n      // \u6784\u5efa\u540e\u662f\u5426\u751f\u6210 soutce map \u6587\u4ef6\n      sourcemap: false,\n      // \u81ea\u5b9a\u4e49\u5e95\u5c42\u7684 Rollup \u6253\u5305\u914d\u7f6e\n      rollupOptions: {\n        input: path.resolve(`index.html`),\n        output: {\n          chunkFileNames: `static/js/[name]-[hash].js`,\n          entryFileNames: `static/js/[name]-[hash].js`,\n          assetFileNames: `static/[ext]/[name]-[hash].[ext]`,\n        },\n      },\n    },\n  }\n});\n')),(0,a.kt)("h2",{id:"3\u6253\u5305\u5de5\u5177\u51fd\u6570-buildjs\u6309\u9700\u6253\u5305"},"3\u3001\u6253\u5305\u5de5\u5177\u51fd\u6570 build.js\uff0c\u6309\u9700\u6253\u5305"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const { resolve } = require(\"path\");\nconst inquirer = require(\"inquirer\");\nconst fs = require('fs');\nconst child_process= require(\"child_process\");\nconst chalk = require(\"chalk\");\n\nclass Build {\n  async main() {\n    // \u8bfb\u53d6\u914d\u7f6e\n    const moduleFile = resolve('.modulerc.ts');\n    let moduleConfig = [];\n    if (fs.existsSync(moduleFile)) {\n      const config = require(moduleFile);\n      moduleConfig = config.packages;\n    }\n    if(process.argv[2]) {\n      const page = process.argv[2].split(',');\n      await this.handleBuild(page);\n      return;\n    }\n    if(moduleConfig?.length) {\n      const choices = moduleConfig.map((item) => item.name);\n      this.questions = [\n        {\n          type: 'checkbox',\n          name: \"page\",\n          message: \"\u9009\u62e9\u8981\u6253\u5305\u7684\u9879\u76ee\",\n          choices,\n        },\n      ];\n    }\n    // \u547d\u4ee4\u884c\u4ea4\u4e92\u6253\u5305\n    await this.selectBuildName();\n  }\n  \n  selectBuildName() {\n    return inquirer.prompt(this.questions).then(async (answers) => {\n      const { page } = answers;\n      await this.handleBuild(page)\n    });\n  }\n\n  async handleBuild(page) {\n    if(page.length) {\n      const cmd = `vite build --`;\n      // \u5faa\u73af\u6253\u5305\n      for (const name of page) {\n        try {\n          console.log(`-------------------- ${name} \u5f00\u59cb\u6253\u5305 --------------------`);\n          await new Promise((resolve, reject) => {\n            child_process.exec(\n              `${cmd} ${name}`,{\n                cwd: process.cwd(),\n                env: {\n                  ...process.env,\n                  VITE_APP_TARGET: name,\n                },\n              },\n              (error, stdout, stderr) => {\n                console.log('stdout: ' + stdout);\n                if (error) {\n                  console.log(chalk.red(`${name} \u6253\u5305\u5931\u8d25`));\n                  console.error(chalk.red('error:', error));\n                  console.log('stderr: ' + stderr);\n                  reject()\n                  process.exit(1);\n                }else {\n                  console.log(chalk.green(`${name} \u6253\u5305\u6210\u529f`));\n                  resolve()\n                }\n              }\n            );\n          })\n        } catch (e) {\n          console.log(chalk.red(`${name} \u6253\u5305\u5931\u8d25`));\n          console.error(chalk.red('error:', e))\n          process.exit(1);\n        }\n      }\n    }\n  }\n}\n\nconst build = new Build();\nbuild.main()\n")),(0,a.kt)("h2",{id:"4modulercts"},"4\u3001.modulerc.ts"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"const packages = [\n  {\n    name: 'page1',\n  },\n  {\n    name: 'page2',\n  },\n];\n\nmodule.exports = {\n  packages,\n}\n")),(0,a.kt)("h2",{id:"5routerindexts-\u6587\u4ef6"},"5\u3001router/index.ts \u6587\u4ef6"),(0,a.kt)("p",null,"\u4f7f\u7528\u7edf\u4e00\u5165\u53e3\uff0c\u6839\u636e\u542f\u52a8\u73af\u5883\u52a0\u8f7d\u4e0d\u540c\u8def\u7531\u6587\u4ef6\uff1a  "),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u672c\u5730\u542f\u52a8\u65f6\u52a0\u8f7d applications\uff0c\u63d0\u4f9b\u7edf\u4e00\u5165\u53e3\uff0c\u96c6\u6210\u6240\u6709\u5b50\u5305\u7684router\uff0c\u65b9\u4fbf\u5f00\u53d1\u8c03\u8bd5\uff1b  "),(0,a.kt)("li",{parentName:"ul"},"\u751f\u4ea7\u73af\u5883\u6253\u5305\u65f6\u6839\u636e VITE_APP_TARGET \u52a0\u8f7d\u5bf9\u5e94\u5b50\u5305\u4e0b\u7684\u8def\u7531\u6587\u4ef6\u3002  ")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"import { createRouter, createWebHashHistory } from \"vue-router\";\nimport type { ModuleNamespace } from \"vite/types/hot\";\n\nconst components:any[] = [];\n\n// \u83b7\u53d6\u6a21\u5757\u4e0b\u7684\u6240\u6709\u8def\u7531\u914d\u7f6e\nconst allModules:Record<string, ModuleNamespace> = import.meta.glob('@/modules/*/router/index.ts', { eager: true });\nObject.values(allModules).forEach((item) => {\n  components.push(item.default);\n});\nconst routes:any[] = [];\nconst {DEV:isDev, VITE_APP_TARGET} = import.meta.env\n\n// \u5f00\u53d1\u73af\u5883\u542f\u52a8\u65f6\u52a0\u8f7dapplications\nif(isDev) {\n  routes.push({\n    path: '/applications',\n    name: 'applications',\n    component: ()=>import('../applications.vue'),\n  });\n  components.forEach((item) => {\n    routes.push(...item);\n  });\n} else {\n  // \u6253\u5305\u65f6\u6839\u636e VITE_APP_TARGET \u52a0\u8f7d\u5bf9\u5e94\u8def\u7531\n  const keys=Object.keys(allModules);\n  for(let i=0; i<keys.length; i++) {\n    if(keys[i].includes(`/modules/${VITE_APP_TARGET}/router`)) {\n      const moduleRoute=allModules[keys[i]].default;\n      routes.push(...moduleRoute)\n      break;\n    }\n  }\n}\nconst router = createRouter({\n  history: createWebHashHistory(import.meta.env.BASE_URL),\n  routes: [\n    {\n      path: '/',\n      redirect: routes[0]?.path,\n      // redirect: '/loading/1/1/1'\n    },\n    ...routes,\n  ],\n});\n\nexport default router;\n\n")),(0,a.kt)("h2",{id:"6applicationsvue"},"6\u3001applications.vue"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-vue"},"<template>\n  <div class=\"box\">\n    <div\n      class=\"box-item\"\n      v-for=\"(item, index) in modules\"\n      :key=\"index\"\n      @click=\"handleToDetail(item)\"\n    >\n      {{ item.name }}\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useRouter } from 'vue-router'\n\nconst router = useRouter();\nconst modules = [\n  {\n    name: '\u6d4b\u8bd5a',\n    path: '/test-index',\n  },\n  {\n    name: '\u6d4b\u8bd5b',\n    path: '/test-b-index',\n  },\n  {\n    name: 'mes',\n    path: '/login',\n  },\n];\n\nfunction handleToDetail(item:any) {\n  router.push({\n    path: item.path,\n  })\n}\n\n<\/script>\n\n<style scoped lang=\"scss\">\n  .box {\n    padding: 20px;\n    &-item {\n      margin-bottom: 15px;\n      height: 40px;\n      line-height: 40px;\n      border: 1px solid #bbb;\n      padding: 0 10px;\n      border-radius: 4px;\n    }\n  }\n</style>\n\n")),(0,a.kt)("h2",{id:"7\u547d\u4ee4"},"7\u3001\u547d\u4ee4"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'"scripts": {\n  "build": "node scripts/build.js",\n},\n')),(0,a.kt)("p",null,"\u4ea4\u4e92\u6253\u5305\uff1a"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cmd"},"npm run build\n")),(0,a.kt)("p",null,"\u6253\u6307\u5b9a\u5305page1\u548cpage2\uff0c\u7528','\u9694\u5f00\uff0c\u4e0d\u8981\u7a7a\u683c"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-cmd"},"npm run build page1,page2\n")),(0,a.kt)("h2",{id:"8\u5355\u5165\u53e3\u603b\u7ed3"},"8\u3001\u5355\u5165\u53e3\u603b\u7ed3"),(0,a.kt)("p",null,"\u501f\u9274\u4e86 ",(0,a.kt)("a",{parentName:"p",href:"https://juejin.cn/post/7065141885576151070#heading-1"},"monorepo"),"\n\u7684\u601d\u60f3\uff0c\u4f46\u8003\u8651\u5230\u6211\u4eec\u5927\u591a\u6570 H5 \u9875\u9762\u5e76\u4e0d\u4f1a\u6709\u592a\u591a\u4ee3\u7801\uff0c\u6240\u4ee5\u6ca1\u6709\u505a\u7684\u5f88\u590d\u6742\uff08\u6240\u4ee5\u6ca1\u6709\u505a\u8fd9\u90e8\u5206\uff1a\u516c\u5171\u5b50\u5305\u3001\u5b50\u5305\u6709\u81ea\u5df1\u7684\u914d\u7f6e\u6587\u4ef6/\u5165\u53e3\u6587\u4ef6\uff0c\u53ef\u4ee5\u5355\u72ec\u542f\u52a8\u3001\u901a\u8fc7\u8f6f\u94fe\u8fdb\u884c\u6a21\u5757\u95f4\u901a\u4fe1\uff09"),(0,a.kt)("p",null,"\u5206\u5305\u4f9d\u636e\uff1a\u5b50\u5305\u5e94\u8be5\u5305\u542b\u7684\u90e8\u5206\uff1a\u9875\u9762\u6587\u4ef6\u3001\u8def\u7531\u6587\u4ef6\u3001\u8be5\u5b50\u5305\u4ee3\u7801\u91cc\u7279\u6709\u7684\u65b9\u6cd5/\u7ec4\u4ef6\u7b49\uff1b\u516c\u5171\u90e8\u5206 index.html \u5165\u53e3\u6587\u4ef6\u3001\u73af\u5883\u53d8\u91cf\u3001\u516c\u5171\u7ec4\u4ef6/\u65b9\u6cd5\u3001\u5404\u79cd\u914d\u7f6e\u6587\u4ef6\uff08\u540e\u7eed\u53ef\u4ee5\u6839\u636e\u9700\u6c42\u518d\u505a\u8c03\u6574\uff09"),(0,a.kt)("h2",{id:"9\u66f4\u6539\u4e3a\u591a\u5165\u53e3"},"9\u3001\u66f4\u6539\u4e3a\u591a\u5165\u53e3"),(0,a.kt)("p",null,"\u539f\u56e0\uff1avite\u4e2d\u901a\u8fc7\u53d8\u91cf\u5199\u5c31\u4f1a\u52a0\u8f7d\u6240\u6709\u7684\u6587\u4ef6\uff0c\u5e76\u4e0d\u4f1a\u6839\u636e\u53d8\u91cf\u8fdb\u884c\u62c6\u5206\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"@/modules/${VITE_APP_TARGET}/router/index.ts"),"\uff0c\u6253\u5305\u540e\u4f1a\u5305\u542b\u6240\u6709\u5305\u7684\u6587\u4ef6\n\u8fd9\u6837\u5199\u5c31\u53ea\u52a0\u8f7d\u5bf9\u5e94\u5305\u4e0b\u7684\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"'@/modules/mes/router/index.ts'")),(0,a.kt)("p",null,"\u8003\u8651\u5230\u8fd9\u4e2a\u95ee\u9898\uff0c\u6539\u4e3a\u591a\u5165\u53e3\uff0c\u6bcf\u4e2a\u5305\u6709\u81ea\u5df1\u7684router\u6587\u4ef6\u540e\uff0c\u4e0d\u5b58\u5728\u901a\u8fc7\u53d8\u91cf\u5f15\u5165\u3002"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"\u4fee\u6539vite.config.ts\u5982\u4e0b")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},"build: {\n  // \u6d4f\u89c8\u5668\u517c\u5bb9\u6027 \u2018esnext\u2019 | 'modules'\n  target: \"modules\",\n  //\u8f93\u51fa\u8def\u5f84\n  outDir: `${process.cwd()}/dist/${packageName}`,\n  // \u5c0f\u4e8e\u6b64\u9608\u503c\u7684\u5bfc\u5165\u6216\u5f15\u7528\u8d44\u6e90\u5c06\u5185\u8054\u4e3a base64 \u7f16\u7801\uff0c \u4ee5\u907f\u514d\u989d\u5916\u7684http\u8bf7\u6c42\uff0c \u8bbe\u7f6e\u4e3a 0, \u53ef\u4ee5\u5b8c\u5168\u7981\u7528\u6b64\u9879\uff0c\n  assetsInlineLimit: 4096,\n  // \u542f\u52a8 / \u7981\u7528 CSS \u4ee3\u7801\u62c6\u5206\n  cssCodeSplit: true,\n  // \u6784\u5efa\u540e\u662f\u5426\u751f\u6210 soutce map \u6587\u4ef6\n  sourcemap: false,\n  // \u81ea\u5b9a\u4e49\u5e95\u5c42\u7684 Rollup \u6253\u5305\u914d\u7f6e\n  rollupOptions: {\n    input: path.resolve(`src/modules/${packageName}/index.html`),\n    output: {\n      chunkFileNames: `static/js/[name]-[hash].js`,\n      entryFileNames: `static/js/[name]-[hash].js`,\n      assetFileNames: `static/[ext]/[name]-[hash].[ext]`,\n    },\n  },\n},\n\n")),(0,a.kt)("h2",{id:"10\u589e\u52a0\u65b0\u5efa\u811a\u672c"},"10\u3001\u589e\u52a0\u65b0\u5efa\u811a\u672c"),(0,a.kt)("p",null,"\u547d\u4ee4\uff1a",(0,a.kt)("inlineCode",{parentName:"p"},"npm run create xxx")),(0,a.kt)("p",null,"create.js"),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-js"},'const { mkdir, readFile, writeFile } = require("fs/promises");\nconst { resolve } = require("path");\n\nconst chalk = require("chalk");\nconst fs = require("fs");\n\nclass CreatePages {\n  constructor() {\n    this.pagesPath = resolve("src/modules");\n    this.pageName = process.argv[2];\n    this.mkPageDir();\n  }\n  // \u521b\u5efa\u76ee\u5f55\n  async mkPageDir() {\n    if(!this.pageName) return this.log(["red", `\u672a\u8f93\u5165\u521b\u5efa\u9879\u76ee\u7684\u540d\u79f0`]);\n    try{\n      await mkdir(`${this.pagesPath}/${this.pageName}`)\n      await mkdir(`${this.pagesPath}/${this.pageName}/router`)\n      await mkdir(`${this.pagesPath}/${this.pageName}/views`)\n      this.log(["green", `\u9879\u76ee\u521b\u5efa\u6210\u529f\uff01`]);\n      this.createFile();\n      this.handleAddModulerc();\n    } catch(e) {\n      this.log(["red", e.message]);\n    }\n  }\n  // \u590d\u5236\u6587\u4ef6\n  createFile() {\n    ["main.ts", "index.html", "router.ts", "router/index.ts", "views/demo.vue"].forEach(async (item) => {\n      try {\n        const fileStr = await readFile(\n          `./scripts/templates/${item}`,\n          "utf-8"\n        );\n        await writeFile(`${this.pagesPath}/${this.pageName}/${item}`, fileStr, "utf-8");\n        this.log(["green", `${item} \u6587\u4ef6\u521b\u5efa\u6210\u529f\uff01`]);\n      } catch (e) {\n        this.log(["red", e.message]);\n      }\n    });\n  }\n  // \u63d2\u5165.modulerc.ts\n  handleAddModulerc() {\n    const moduleFile = resolve(\'.modulerc.json\');\n    const jsonData = fs.readFileSync(moduleFile)\n    const jsonObj=JSON.parse(jsonData);\n    jsonObj.push({name: this.pageName})\n    fs.writeFileSync(moduleFile, JSON.stringify(jsonObj, null, 2))\n  }\n  log([key, value]) {\n    try {\n      console.log(chalk[key](`\\n => ${value}`));\n    } catch (e) {\n      console.log(chalk.red(`\\n => ${e.message} \\n`));\n    }\n  }\n}\n\nnew CreatePages();\n')))}m.isMDXComponent=!0}}]);